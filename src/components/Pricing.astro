---
import { Check } from "lucide-react";
import pricingData from "../data/pricing.json";
import { isOfferActive, calculateDiscountedPrice } from "../utils/offerUtils";

const offerActive = isOfferActive(pricingData.offer);
const discountPercentage = offerActive ? pricingData.offer.percentage : 0;

// Calculate prices
const annualPrice = pricingData.plans.annual.basePrice;
const annualDiscounted = calculateDiscountedPrice(
  annualPrice,
  discountPercentage,
);
---

<section id="pricing" class="py-20 bg-white">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-16">
      <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
        Planes Transparentes
      </h2>
      <p class="text-xl text-gray-600 max-w-3xl mx-auto">
        Elige el plan que mejor se adapte a tu negocio. Sin costos ocultos.
      </p>
    </div>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-5xl mx-auto">
      <!-- Plan B치sico -->
      <div
        class="bg-white rounded-2xl p-8 shadow-lg border border-gray-100 hover:border-nodo-purple transition-colors relative"
      >
        <!-- Badge de oferta -->
        {
          offerActive && (
            <div class="absolute top-4 right-4 bg-red-600 text-white text-xs font-bold px-3 py-1 rounded-full animate-pulse">
              {pricingData.offer.badge}
            </div>
          )
        }
        <h3 class="text-xl font-bold text-gray-900 mb-2">
          {pricingData.plans.annual.name}
        </h3>
        <p class="text-gray-500 text-sm mb-6">
          {pricingData.plans.annual.description}
        </p>
        {
          offerActive && (
            <div class="flex items-baseline mb-2">
              <span class="text-2xl text-gray-400 line-through mr-2">
                ${annualPrice.toLocaleString("es-CO")}
              </span>
            </div>
          )
        }
        <div class="flex items-baseline mb-6">
          <span
            class={`text-4xl font-bold ${offerActive ? "text-red-600" : "text-gray-900"}`}
          >
            ${annualDiscounted.toLocaleString("es-CO")}
          </span>
          <span class="text-gray-500 ml-2">/a침o</span>
        </div>
        <div class="bg-green-50 border border-green-200 rounded-lg p-3 mb-4">
          <p class="text-xs text-green-800 font-semibold">
            {pricingData.plans.annual.highlight}
          </p>
        </div>
        <ul class="space-y-4 mb-8">
          {
            pricingData.plans.annual.features.map((feature) => (
              <li class="flex items-start gap-3">
                <Check size={20} className="text-green-500 mt-0.5" />
                <span class="text-gray-600">{feature}</span>
              </li>
            ))
          }
        </ul>
        <a
          href="#contact"
          class="block w-full py-3 px-6 text-center rounded-xl border-2 border-nodo-purple text-nodo-purple font-bold hover:bg-nodo-purple hover:text-white transition-colors"
        >
          Solicitar Cotizaci칩n
        </a>
      </div>

      <!-- Plan Avanzado -->
      <div
        class="bg-nodo-dark rounded-2xl p-8 shadow-xl border border-gray-800 relative transform md:-translate-y-4"
      >
        {
          pricingData.plans.equipment.popular && (
            <div class="absolute top-0 right-0 bg-nodo-purple text-white text-xs font-bold px-3 py-1 rounded-bl-xl rounded-tr-xl">
              M츼S POPULAR
            </div>
          )
        }
        <h3 class="text-xl font-bold text-white mb-2">
          {pricingData.plans.equipment.name}
        </h3>
        <p class="text-gray-400 text-sm mb-6">
          {pricingData.plans.equipment.description}
        </p>
        <div class="flex items-baseline mb-6">
          <span class="text-4xl font-bold text-white">Consultar</span>
        </div>
        <ul class="space-y-4 mb-8">
          {
            pricingData.plans.equipment.features.map((feature) => (
              <li class="flex items-start gap-3">
                <Check size={20} className="text-nodo-purple mt-0.5" />
                <span class="text-gray-300">{feature}</span>
              </li>
            ))
          }
        </ul>
        <a
          href="#contact"
          class="block w-full py-3 px-6 text-center rounded-xl bg-nodo-purple text-white font-bold hover:bg-purple-600 transition-colors shadow-lg shadow-purple-900/20"
        >
          Contactar Asesor
        </a>
      </div>

      <!-- Paquetes de Folios -->
      <div
        class="bg-white rounded-2xl p-8 shadow-lg border border-gray-100 hover:border-nodo-purple transition-colors relative"
      >
        {
          offerActive && (
            <div class="absolute top-4 right-4 bg-red-600 text-white text-xs font-bold px-3 py-1 rounded-full animate-pulse">
              {pricingData.offer.badge}
            </div>
          )
        }
        <h3 class="text-xl font-bold text-gray-900 mb-2">Paquetes de Folios</h3>
        <p class="text-gray-500 text-sm mb-2">Recargas adicionales</p>
        <div class="bg-purple-50 border border-purple-200 rounded-lg p-3 mb-4">
          <p class="text-xs text-purple-800 font-semibold">
            游꾸 Folios SIN fecha de caducidad
          </p>
        </div>
        <div class="space-y-4 mb-8">
          {
            pricingData.folios.map((folio) => {
              const folioDiscounted = calculateDiscountedPrice(
                folio.basePrice,
                discountPercentage,
              );
              const isUnlimited = folio.quantity === "unlimited";

              return (
                <div
                  class={`flex justify-between items-center p-3 rounded-lg ${
                    folio.highlight
                      ? "bg-green-50 border-2 border-green-500"
                      : "bg-gray-50"
                  }`}
                >
                  <div>
                    <span class="font-medium text-gray-700">
                      {isUnlimited
                        ? folio.label
                        : `${folio.quantity.toLocaleString("es-CO")} Folios`}
                    </span>
                    {isUnlimited && (
                      <div class="text-xs text-green-700 font-semibold">
                        {folio.duration}
                      </div>
                    )}
                  </div>
                  <div class="text-right">
                    {offerActive && (
                      <div class="text-sm text-gray-400 line-through">
                        ${folio.basePrice.toLocaleString("es-CO")}
                      </div>
                    )}
                    <div
                      class={`font-bold ${offerActive ? "text-red-600" : "text-gray-900"}`}
                    >
                      ${folioDiscounted.toLocaleString("es-CO")}
                    </div>
                  </div>
                </div>
              );
            })
          }
        </div>
        <a
          href="#contact"
          class="block w-full py-3 px-6 text-center rounded-xl border-2 border-gray-200 text-gray-600 font-bold hover:border-nodo-purple hover:text-nodo-purple transition-colors"
        >
          Comprar Folios
        </a>
      </div>
    </div>
  </div>
</section>
